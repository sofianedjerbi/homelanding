---
import { getLangFromUrl, languages } from '../i18n/translations';

interface Props {
  title: string;
}

const { title } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const otherLang = lang === 'en' ? 'fr' : 'en';
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
    <title>{title}</title>
  </head>
  <body>
    <!-- Data flow particles -->
    <div class="data-particles">
      <div class="particle" style="left: 10%; animation-delay: 0s;"></div>
      <div class="particle" style="left: 20%; animation-delay: 2s;"></div>
      <div class="particle" style="left: 35%; animation-delay: 4s;"></div>
      <div class="particle" style="left: 50%; animation-delay: 1s;"></div>
      <div class="particle" style="left: 65%; animation-delay: 3s;"></div>
      <div class="particle" style="left: 80%; animation-delay: 5s;"></div>
      <div class="particle" style="left: 90%; animation-delay: 2.5s;"></div>
      <div class="particle" style="left: 15%; animation-delay: 6s;"></div>
      <div class="particle" style="left: 45%; animation-delay: 7s;"></div>
      <div class="particle" style="left: 75%; animation-delay: 8s;"></div>
    </div>

    <!-- Grid background -->
    <div class="grid-bg"></div>

    <!-- Gradient mesh -->
    <div class="gradient-mesh">
      <div class="mesh-blob mesh-1"></div>
      <div class="mesh-blob mesh-2"></div>
      <div class="mesh-blob mesh-3"></div>
    </div>

    <!-- Spotlight -->
    <div class="spotlight" id="spotlight"></div>

    <nav class="nav">
      <a href={`/${otherLang}`} class="lang-toggle">
        <span class="lang-current">{lang.toUpperCase()}</span>
        <span class="lang-divider">/</span>
        <span class="lang-other">{otherLang.toUpperCase()}</span>
      </a>
    </nav>

    <slot />
  </body>
</html>

<style is:global>
  :root {
    --bg: #030303;
    --text: #ffffff;
    --text-secondary: #a0a0a0;
    --text-tertiary: #666666;
    --accent: #0070f3;
    --accent-pink: #f81ce5;
    --accent-purple: #7928ca;
    --accent-cyan: #00dfd8;
    --accent-green: #22c55e;
    --card-bg: rgba(20, 20, 20, 0.8);
    --card-border: rgba(255, 255, 255, 0.1);
    --card-border-hover: rgba(255, 255, 255, 0.2);

    /* Glows */
    --glow-green: 0 0 15px rgba(34, 197, 94, 0.4);
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg);
    color: var(--text);
    -webkit-font-smoothing: antialiased;
  }

  body {
    min-height: 100vh;
    overflow-x: hidden;
    background: var(--bg);
  }

  /* Data flow particles */
  .data-particles {
    position: fixed;
    inset: 0;
    pointer-events: none;
    overflow: hidden;
    z-index: 0;
  }

  .particle {
    position: absolute;
    width: 2px;
    height: 2px;
    background: var(--accent);
    border-radius: 50%;
    opacity: 0;
    animation: particleFlow 12s linear infinite;
  }

  .particle:nth-child(odd) {
    background: var(--accent-cyan);
  }

  .particle:nth-child(3n) {
    width: 3px;
    height: 3px;
    background: var(--accent-purple);
  }

  @keyframes particleFlow {
    0% {
      transform: translateY(-10px);
      opacity: 0;
    }
    5% {
      opacity: 0.4;
    }
    90% {
      opacity: 0.3;
    }
    100% {
      transform: translateY(100vh);
      opacity: 0;
    }
  }

  /* Grid background */
  .grid-bg {
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
    background-size: 50px 50px;
    mask-image: radial-gradient(ellipse 60% 60% at 50% 50%, black 20%, transparent 70%);
    -webkit-mask-image: radial-gradient(ellipse 60% 60% at 50% 50%, black 20%, transparent 70%);
    pointer-events: none;
  }

  /* Gradient mesh blobs */
  .gradient-mesh {
    position: fixed;
    inset: 0;
    overflow: hidden;
    pointer-events: none;
  }

  .mesh-blob {
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0.6;
    animation: float 20s ease-in-out infinite;
  }

  .mesh-1 {
    width: 700px;
    height: 700px;
    top: -20%;
    left: -10%;
    background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-pink) 100%);
    animation-delay: 0s;
  }

  .mesh-2 {
    width: 500px;
    height: 500px;
    top: 40%;
    right: -15%;
    background: linear-gradient(135deg, var(--accent) 0%, var(--accent-cyan) 100%);
    animation-delay: -7s;
  }

  .mesh-3 {
    width: 400px;
    height: 400px;
    bottom: -10%;
    left: 20%;
    background: linear-gradient(135deg, var(--accent-pink) 0%, var(--accent) 100%);
    animation-delay: -14s;
  }

  @keyframes float {
    0%, 100% { transform: translate(0, 0) rotate(0deg); }
    25% { transform: translate(30px, -30px) rotate(5deg); }
    50% { transform: translate(-20px, 20px) rotate(-5deg); }
    75% { transform: translate(40px, 10px) rotate(3deg); }
  }

  /* Spotlight */
  .spotlight {
    position: fixed;
    width: 400px;
    height: 400px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255,255,255,0.08) 0%, transparent 70%);
    pointer-events: none;
    transform: translate(-50%, -50%);
    z-index: 10;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  body:hover .spotlight {
    opacity: 1;
  }

  /* Nav */
  .nav {
    position: fixed;
    top: 0;
    right: 0;
    padding: 1.5rem 2rem;
    z-index: 100;
  }

  .lang-toggle {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.625rem 1rem;
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    font-size: 0.8125rem;
    font-weight: 600;
    color: var(--text-secondary);
    text-decoration: none;
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    transition: all 0.3s ease;
  }

  .lang-toggle:hover {
    background: rgba(30, 30, 30, 0.9);
    border-color: var(--card-border-hover);
    transform: translateY(-2px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  }

  .lang-current {
    color: var(--text);
  }

  .lang-divider {
    opacity: 0.4;
  }

  .lang-other {
    opacity: 0.6;
  }

  .lang-toggle:hover .lang-other {
    opacity: 1;
  }

  a {
    color: inherit;
    text-decoration: none;
  }

  ::selection {
    background: var(--accent);
    color: white;
  }

  /* Respect reduced motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .particle,
    .mesh-blob {
      animation: none !important;
    }

    .particle {
      display: none;
    }

    .mesh-blob {
      opacity: 0.4;
    }
  }
</style>

<script>
  const spotlight = document.getElementById('spotlight');
  if (spotlight) {
    document.addEventListener('mousemove', (e) => {
      spotlight.style.left = e.clientX + 'px';
      spotlight.style.top = e.clientY + 'px';
    });
  }
</script>
